---
name: codeQL-task
on:
  push:
    branches:
      - "develop"
      - "main"

jobs:
  codeql-job:
    name: codeql-job
    runs-on: ubuntu-latest
    steps:
      - name: Cdeckout repository
        uses: actions/checkout@v3

      - name: Setup CodeQL
        run: |
          wget https://github.com/github/codeql-cli-binaries/releases/download/v2.3.4/codeql-osx64.zip
          unzip codeql-osx64.zip
          rm -f codeql-osx64.zip
          git clone -b v1.26.0 https://github.com/github/codeql.git ql

      - name: Run codeQL-task
        run: |
          mkdir -p  codeql_work
          ./codeql database create codeql_work/codeql-database --language=cpp --command='bazel build //main:hello-world'
          echo "success"

      - name: Clean workspace
        if: ${{ always() }}
        run: |
          chmod +w ${{github.workspace}} -Rf
          rm -rf ${{github.workspace}}/*
